## EC2

애플리케이션을 호스팅하고 컴퓨팅 파워를 제공하려면 컴퓨터 용량이 필요하다. 이것을 EC2 인스턴스 라고 한다.

EC2를 사용 하는 것이 온프레미스로 사용하는 것보다 훨씬 유연하고 효율적이며 빠르다.

온프레미스를 사용하기 위한 자금과 시간이 많이 필요하지만 EC2를 사용하면 지불하지 않아도 된다.

고객은 EC2 용량을 마음대로 조절하며 사용할 수 있다.

원하는 용량의 EC2 인스턴스를 고객이 요청하기만 하면 빠른시간 내에 사용할 수 있다.

EC2는 사용한 만큼 비용을 지불하면 되는 온디맨드 형식으로 구성된다.

EC2 인스턴스는 가상 머신이다.

여기서 가장 중요한 부분이 나온다. VM은 하나의 호스트 OS에 가상화 하여 다른 OS를 사용할 수 있다.

VM은 기본 물리적 호스트 컴퓨터를 **다른 여러 인스턴스와 공유**하는데, 이를 **멀티테넌시**라고 한다.

다중 테넌트 환경에서 VM이 나누어져 있는 상황이어도 호스트에서 제공하는 리소스를 계속 공유할 수 있어야 한다.

이런 리소스 공유와 VM 격리 작업을 하이퍼바이저가 수행한다.

EC2 인스턴스를 프로바이저닝 할 때 여러 OS를 사용할 수 있다.

## EC2 인스턴스 유형

AWS 환경에서는 다양한 환경에서 사용할 수 있는 인스턴스들이 있다.

CPU, 메모리, 스토리지, 네트워킹 용량 등 다양한 조합을 제공하는 인스턴스 패밀리로 그룹화 된다.

때문에 사용자에 맞는 EC2 인스턴스 용량을 사용할 수 있다.

인스턴스 패밀리는 다음과 같이 분류된다.

1. 범용
2. 컴퓨팅 최적화
3. 메모리 최적화
4. 가속 컴퓨팅 
5. 스토리지 최적화

### 범용 인스턴스

컴퓨팅, 메모리, 네트워킹 리소스를 균형있게 제공한다.

### 컴퓨팅 최적화 인스턴스

게임 서버, 고성능 컴퓨팅, 데이터 모델링 같이 집약적인 기술에 유용하다.

### 메모리 최적화 인스턴스

메모리를 많이 사용하는 태스크에 적합하다. 메모리에서 대규모 데이터를 처리하는 워크로드를 제공한다.

### 가속 컴퓨팅 인스턴스

그래픽 처리 등에 적합하다. 하드웨어 가속기(GPU) 를 사용하기 때문이다.

### 스토리지 최적화 인스턴스

로컬에 저장된 데이터에 대해 고성능이 필요한 워크로드가 필요할 때 사용한다.

이렇게 상황과 고객에 맞게 인스턴스를 고른 후 인스턴스 크기를 정해야 한다.

## AMI

### 구성요소

운영체제, 스토리지 설정, 아키텍처 유형, 시작에 필요한 권한, 이미 설치된 추가 소프트웨어가 포함된다.

하나의 AMI 설정을 가지고 동일한 설정의 EC2 여러개를 생성할 수 있다.

### AMI를 사용하는 방법

1. 사용자가 직접 AMI를 지정하여 생성
    - 필요에 맞게 맞춤 설정된 특정한 구성 및 소프트웨어로 사용자 지정 AMI를 구축하여 자체 AMI를 생성한다.
2. 일반 운영 체제 및 소프트웨어용으로 생성
    - AWS AMI를 사용할 수 있다.
3. AWS Marketplace에서 AMI를 구매하여 생성
    - 특정한 사용 사례에 맞게 설계된 특수 소프트웨어를 서드 파티 공급업체가 제공하는 AMI를 사용할 수 있다.

![image.png](attachment:6e6125e6-c91a-4b39-8cbf-1a9d6f128241:image.png)

## EC2 요금

EC2의 요금을 내는 방법은 크게 5가지가 있다.

1. 온디맨드 방식
    - 사용한 만큼 돈을 지불한다.
2. 절감형 플랜
    - 1 ~ 3년 약정을 통해 시간에 따라 돈을 지불하는 것이다. 보다 싸게 서비스를 사용할 수 있다.
3. 예약 인스턴스
    - 1년 또는 3년 약정을 체결하여 약정 기간 동안 계속 사용하는 것이다.
4. 스팟 인스턴스
    - AWS가 언제든지 인스턴스를 회수할 수 있다. 하지만 90% 사용료를 절감할 수 있다.
5. 전용 호스트
    - 고객이 독점으로 사용할 수 있는 물리적인 서버이다. 서버를 공유하지 않아 보안이 중요할 때 사용한다.

### 전용 인스턴스

AWS 계정과 물리적으로 격리된다.

전용 호스트와 비슷하지만, 보안이 전용호스트보다 필요하지 않을 때 많이 사용한다.

## EC2 스케일링

### 확장성

리소스를 추가하여 증가한 로드를 처리할 수 있는 시스템의 능력을 말한다.

스케일 업과 스케일 아웃이 있다.

### 탄력성

실시간 수요에 따라 리소스를 자동으로 스케일 업하거나 스케일 다운하는 기능이다.

시스템에서 리소스를 빠르게  조정하여 비용 효율적이게 동작하고, 최적의 리소스 사용을 제공한다.

## **EC2 Auto Scaling**

애플리케이션 수요의 변화에 따라 EC2 인스턴스 수를 자동으로 조정하여 가용성을 더욱 높이는 기술이다.

동적 스케일링과 예측 스케일링으로 나뉜다.

**동적 스케일링**은 수요 변동에 따라 실시간으로 조정하는 스케일링 방식이다.

**예측 스케일링**은 예상 수요에 따라 적절한 수의 인스턴스를 선제적으로 예약하는 스케일링 방식이다.

**Auto Scaling** 그룹은 3가지 **키 설정**으로 구성된다.

1. **최소 용량** : 애플리케이션을 계속 실행하는 데 필요한 최소 EC2 인스턴스 수를 정의한다.
2. **원하는 용량** : Auto Scaling이 유지하고자 하는 현재 워크로드(백엔드) 를 처리하는 데 필요한 이상적인 인스턴스 수
3. **최대 용량** : 시작할 수 있는 인스턴스 수의 상한선을 설정하여 초과 스케일링을 방지하고 비용을 제어한다.

## **Elastic Load Balancing**

모든 티어에 수백 또는 수천 개의 인스턴스가 있을 때 ELB 같은 중앙 관제 센터가 없다면 모든 것을 동기화 하는 작업이 힘들어질 수 있다.

따라서 AWS는 ELB를 사용하여 백엔드 인스턴스와 프론트엔드 인스턴스의 연결을 쉽고 체계적으로 관리할 수 있다.

만약  백엔드의 규모를 조정해야 할 경우, 새 인스턴스가 가동된다. 새 인스턴스가 준비되면 ELB에 트래픽을 처리할 준비가 완료되었음을 알리기만 하면 동작한다. 

이 방식을 사용하면 방금 예시와 같이 프론트엔드 인스턴스는 백엔드 관련 데이터가 없어도 ELB의 관제를 통해 작동할 수 있다.

![image.png](attachment:26d0025d-d95a-4bd3-90b1-a41d38f378b0:image.png)

### ELB의 장점

1. 효율적인 트래픽 분산
    - EC2 인스턴스 전체에 균일하게 분산하여 단일 인스턴스의 과부하를 방지하고 리소스 활용도를 높인다.
2. 오토 스케일링
    - ELB는백엔드 인스턴스가 추가되거나 제거될 때 중단 없는 운영을 위해 트래픽의 규모를 조정하고, 수요 변화에 따라 자동으로 조정한다.
3. 관리 간소화
    - ELB는프런트엔드 티어와 백엔드 티어의 결합을 해제하여 수동적인 관리를 줄인다.

### ELB의 라우팅 방법

1. 라운드 로빈
    - 사용 가능한 모든 서버에 주기적으로 트래픽을 균등하게 분산한다.
    
    ![image.png](attachment:87b100db-9a7c-40c9-99ff-87278eb916de:image.png)
    
2. 최소 연결
    - 로드 밸런싱을 유지하며 활성화 된 서버 중 가장 적은 트래픽을 가진 서버에게 라우팅한다.
    - **로드 밸런싱** : 트래픽을 자동으로 분산시켜 시스템의 가용성과 안정성을 높이는 서비스
3. IP 해시
    - 클라이언트의 IP 주소를 사용하여 트래픽을 동일한 서버로 일관되게 라우팅한다.
4. 최소 응답 시간
    - 응답 시간이 가장 빠른 서버로 라우팅한다.

## 확장과 신뢰가능한 클라우드 통신 지원

Amazon EventBridge, Amazon SNS, Amazon SQS는 애플리케이션의 여러 요소가 클라우드에서 효과적으로 통신할 수 있도록 지원하는 AWS 서비스이다.

### **EventBridge**

이벤트를 사용해 애플리케이션의 여러 요소를 연결하여 확장 가능한 이벤트 기반 시스템을 구축하도록 지원하는 서버리스 서비스이다.

사용자 지정 앱, AWS 서비스, 서드 파티 소프트웨어 등 여러 소스 이벤트를 다른 애플리케이션으로 라우팅할 수 있다.

### **Amazon SQS**

소프트웨어 구성 요소 간의 신뢰할 수 있는 통신을 지원하는 메시지 대기열 처리 서비스이다.

### **Amazon SNS**

게시자가 SNS 주제를 통해 구독자에게 메시지를 보내는 데 사용하는 게시-구독 서비스이다.
