# VTP

**VTP (VLAN Trunking Protocol)**

### VTP란?

VTP는 VLAN Dynamic Mode처럼 VLAN 설정에 도움이 되는 프로토콜이다. 

관리해야 하는 스위치 VLAN이 많을 경우 유용하게 사용될 수 있다.

장점

- 사람이 관리하다가 명령어 오ㅊ입력, 누락등 실수를 최소화 할 수 있다.

단점

- 보안상의 문제로 잘 사용되지 않는다.

### VTP 사용조건

1. VTP Domain name 설정
    - VTP는 스위치에서 기본적으로 항상 동작하고 있는 상태이고, **종료할 수 없는 프로토콜**이다. VTP Domain name을 설정하여 VLAN 정보를 동기화 한다. (VTP 사용을 위해서 Domain name을 같게 설정해주어야 한다.)
2. Trunk Port 설정
    - VTP 메시지는 Trunk Port 에서만 전달될 수 있다.

1. VTP password 일치
    - VTP는 보안 측면에서 취약한 프로토콜이다. VTP 정보를 무분별하게 받아와 갱신하는 것을 방지하고자 VTP password 설정이 필요하다. name과 password를 설정하여 동기화 진행한다.

### 동작원리

1. 스위치에 VLAN 정보 추가, 수정, 삭제가 이루어 진다면 다른 스위치에 알린다.
2. 스위치는 1번과 같은 작업이 이루어지면 VTP 설정 번호를 기존값에서 +1하여 다른 스위치에게 전송한다.
3. VTP 정보를 수신한 다른 스위치는 자신의 VTP 설정 번호와 비교하여 설정 폐기한다.
    - 수신한 설정 번호가 더 높다면 VLAN 정보를 갱신
    - 수신한 설정 번호가 같으면 VLAN 정보를 유지하고 수신한 정보를 폐기
    - 자신의 설정 번호가 더 높으면 자신의 VLAN 정보르 전송

### VTP 모드

| VTP 모드 | 역할 설명 | VLAN 정보 생성/수정 | VLAN 정보 저장 (vlan.dat) | VLAN 광고 (전파) | 수신한 VLAN 정보 반영 |
| --- | --- | --- | --- | --- | --- |
| **Server** | 중앙 관리자 역할. VLAN을 생성/변경하고 네트워크에 전파함 | 가능 | O | O | O |
| **Client** | 직접 VLAN을 생성하지는 못하고 서버에서 받은 정보를 적용함 | 불가능 | X (RAM에서만 유지) | X | O |
| **Transparent** | VLAN을 생성/수정 가능하지만 VTP 광고에는 참여하지 않음. 광고는 전달함 | 가능 | O | X (광고 X) | X (무시) |

**각 모드 요약**

1. Server 모드
    - VLAN 생성, 수정, 삭제 가능

1. Client 모드
    - VLAN 생성, 수정 불가
    - 서버에서 받은 VLAN만 사용
    - VLAN 정보는 RAM에 저장 (**재부팅 시 초기화**)

1. Transparent 모드
    - VLAN 생성, 수정 가능 (Local VLAN 한정)
    - 다른 스위치에 VLAN 정보 전송 X
    - VTP 메시지 수신 시 무시 (전달은 가능)
    - 네트워크 전체와 무관하게 동작

**사용 추천**